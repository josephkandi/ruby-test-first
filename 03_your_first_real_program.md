# Chapter 3: Your First Real Program

Now that we’ve got a [taste](02-hello-world.md) of how test-first development works, let’s learn some Ruby!

## A little more setup

In our “Hello World” example, we used a test library called Minitest. We did this because Minitest is part of Ruby’s standard library [TODO: removed from standard library as of 2.2—maybe we should just start with RSpec], so no additional installation was necessary. However, Minitest is a bit underpowered, and so for the rest of this book, we will be using a similar but more powerful tool called [RSpec](http://rspec.info/).

Since RSpec doesn’t come with our standard library, though, we have to install it. [TODO: more detailed instructions -- install Bundler, create `Gemfile` with RSpec, `bundle install`, `rspec --init`.]

TODO: Create `ch03/leap_year` directory.

## Leap years

For our first program, let’s create a routine that tells us if a given year is a leap year. Recall that in the Gregorian calendar, a year is a leap year under the following conditions:

1. If the year does not end in 00, it is a leap year if it is evenly divisible by 4. **Example**: 1952 ÷ 4 = 488, with no remainder, so 1952 was a leap year.
2. If the year does end in 00, it is a leap year only if it is evenly divisible _by 400_. **Example**: 2000 ÷ 400 = 5, so 2000 was a leap year. 1900 ÷ 400 = 4.75, so 1900 was _not_ a leap year, even though 1900 is divisible by 4.
3. Otherwise, it is not a leap year.

Since the Gregorian calendar was gradually adopted during the 18th century, our program will not consider years before 1800, and will return an error message if give it a year before that time.

## Writing the first test

We now have an idea of what we’d like our program to do, so let’s write the first test. To do this, we pick a small piece of functionality to start off with, generally one that is simple to implement. We choose a small, simple piece so that we can get quick feedback about whether our system is working. Once the first piece is working, we will choose another small piece, and so on, bit by bit, till we have implemented everything we need.

The simplest piece to start with will probably be the non-leap-year case (3. above). Put the following in `spec/leap_year_spec.rb`:

<pre><code class='lang-ruby'>
{% include "git+https://github.com/marnen/ruby-test-first-code.git/ch03/leap_year/spec/leap_year_spec.rb#03-leap-year-1" %}
</code></pre>

If we run `bundle exec rspec`, we will get an error, because Ruby cannot find the file named `leap_year`. So create an empty file called `leap_year.rb` and run RSpec again. This will give us our first failing test:

```
Failures:

  1) leap_year? returns false
     Failure/Error: expect(leap_year? year).to be == false

     NoMethodError:
       undefined method `leap_year?' for #<RSpec::ExampleGroups::LeapYear:0x007fc2f1b347d0>
     # ./spec/leap_year_spec.rb:7:in `block (2 levels) in <top (required)>'
 ```

 Before we make this test pass, let’s look in more detail at the contents of `spec/leap_year_spec.rb`.

 The `require` lines at the top tell Ruby where to find other code we need. `spec_helper` is a file that was generated by `rspec --init`; it sets up the test environment. `leap_year` will be our implementation file. (The `.rb` extension is implied and is not necessary here.)
